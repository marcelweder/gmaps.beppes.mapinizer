// Generated by CoffeeScript 1.4.0
/*

Google Maps App, aka BeppesMapinizer
Author: Marcel A. Weder
*/(function(){"use strict";var e,t,n,r,i,s,o,u,a,f;o=window.google;e=window.jQuery;f=[];a=[{marker:null,latitude:47.411993,longitude:9.625236,icon:"/location/icons/maps-marker-home.png",zIndex:100,trigger:!1}];n=e('<input type="text" id="beppeto" value="Chur/GR, Bahnhof" placeholder="...">');r=e('<select id="travelmode"><option value="TRANSIT">Transit</option><option value="BICYCLING">Fahrrad</option><option value="WALKING">Zu Fuss</option></select>');i=e('<input type="checkbox" id="preserveViewport" title="Ganze Route anzeigen">');t=e('<div><div class="infowindow-content"><form class="form" id="routeplaner" onsubmit="return window.beppe.calcRoute(); return false;"></form></div></div>');s=function(){function s(t,n,r){this.canvas=t;this.results=n;this.options=r;this.defaults={panoramio:!1,weather:!1,bicycling:!1,cloud:!1,transit:!1,traffic:!1};this.options=e.extend(this.defaults,this.options||{});this.map=null;this.mapOptions={scrollwheel:!1,zoom:15,mapTypeControl:!0};this.mapControl=null;this.directions=null;this.directionsOptions={};this.directionsService=null;this.directionsOptions={hideRouteList:!1,preserveViewport:!0,suppressMarkers:!1,draggable:!0,polylineOptions:{strokeColor:"#00ccff",strokeWeight:5,strokeOpacity:.8}};this.resultsRouter=null;this.resultsRouterContent=null;this.infoWinVisible=!1;this.infoWin=null;this.panoramio=null;this.panoramioWidget=!!window.panoramio;this.panoramioCfg={tag:"heerbrugg",suppressInfoWindows:this.panoramioWidget};this.weather=null;this.bicycling=null;this.cloud=null;this.transit=null;this.traffic=null;this.routeLocked=!1;this.mapCoordinates={center:{latitude:47.414455,longitude:9.617414},moi:{latitude:47.411993,longitude:9.625236},centerLatLan:null,moiLatLan:null}}s.prototype.setupMap=function(){var t,n,r,i;i=this;this.options.mapCoordinates&&e.extend(this.mapCoordinates,this.options.mapCoordinates);this.mapCoordinates.centerLatLan=new o.maps.LatLng(this.mapCoordinates.center.latitude,this.mapCoordinates.center.longitude);this.mapCoordinates.moiLatLan=new o.maps.LatLng(this.mapCoordinates.moi.latitude,this.mapCoordinates.moi.longitude);e.extend(this.mapOptions,{mapTypeId:o.maps.MapTypeId.SATELLITE,mapTypeControlOptions:{style:o.maps.MapTypeControlStyle.DEFAULT},center:this.mapCoordinates.centerLatLan},this.options.mapCfg||{});this.options.panoramioCfg&&e.extend(this.panoramioCfg,this.options.panoramioCfg);this.map=new o.maps.Map(this.canvas,this.mapOptions);t=e("#map-control").show();n=e("#map-directions");r=e("#map-directions-results");this.mapControl=t;this.resultsRouter=n;this.resultsRouterContent=r;n.find(".close").on("click",function(t){t.preventDefault();n.hide();i.unsetDirections();e("#map-control").trigger("activated");return!1})};s.prototype.stateInfoWin=function(e){e=e||null;if(e===null)return this.infoWinVisible;this.infoWinVisible=e};s.prototype.setupInfoWin=function(){var e;e=this;this.infoWin=new o.maps.InfoWindow({maxWidth:500,disableAutoPan:!1,pixelOffset:new o.maps.Size(8,-32)});o.maps.event.addListener(this.infoWin,"closeclick",function(){e.infoWinVisible=!1})};s.prototype.setupMarker=function(){var s,u,l,c,h;l=this;s=function(s){var u,a;u=s.icon?new o.maps.MarkerImage(s.icon,new o.maps.Size(52,56,"px","px")):null;a=new o.maps.Marker({animation:o.maps.Animation.DROP,icon:u,title:s.title,zIndex:parseInt(s.zIndex,null),position:new o.maps.LatLng(s.latitude,s.longitude)});a.setMap(l.map);o.maps.event.addListener(a,"click",function(){var s,o;if(!l.infoWinVisible){l.infoWin.setPosition(this.getPosition());o=l.resultsRouter.data("request");if(o){n.attr("value",o.destination);r.find("option").removeAttr("selected").filter(function(){e(this).val()===o.travelMode&&e(this).attr("selected","selected");return!0});i.removeAttr("checked");o.preserveViewport&&i.attr("checked","checked")}s=t.find("#routeplaner").empty();s.append('<label for="beppeto">Wohin geht die Reise?</label>');s.append(e('<div class="control-group">').append(e('<div class="controls">').append(e('<div class="input-append">').append(n,'<button class="btn" type="submit">Go!</button>'))));s.append(e('<div class="control-group">').append(e('<div class="controls controls-row">').append(r.addClass("span6"),e('<label class="checkbox span6">').text("Zoom").prepend(i))));l.infoWin.setContent(t.html());l.infoWin.open(l.map);l.infoWinVisible=!0}else{l.infoWin.close();l.infoWinVisible=!1}});s.trigger&&o.maps.event.trigger(a,"click");f.push(a)};for(c=0,h=a.length;c<h;c++){u=a[c];s(u)}};s.prototype.initDirections=function(){this.directionsService=new o.maps.DirectionsService;this.directions=new o.maps.DirectionsRenderer(this.directionsOptions);this.results=document.getElementById(this.results||"");this.results&&this.directions.setPanel(this.results)};s.prototype.setDirections=function(e){e=e||null;this.directions.setMap(this.map);e&&this.directions.setOptions(e)};s.prototype.unsetDirections=function(){this.directions.setMap(null)};s.prototype.mapInitialize=function(){this.canvas=document.getElementById(this.canvas||"");if(!this.canvas)return!1;this.initDirections();this.setupMap();this.setupInfoWin();this.setupMarker();this.options.panoramio&&this.setPanoramino(this.panoramioCfg);this.options.weather&&this.setWeather();this.options.cloud&&this.setCloud();this.options.bicycling&&this.setBicycling();this.options.transit&&this.setTransit();this.options.traffic&&this.setTraffic()};s.prototype.calcRoute=function(){var t,n,r,i,s,u;s=this;this.routeLocked=!0;n=e("#preserveViewport").is(":checked");this.setDirections({preserveViewport:!n});this.mapControl.trigger("deactivated");this.unsetPanoramino();this.unsetWeather();this.unsetCloud();this.unsetBicycling();this.unsetTraffic();i=this.mapCoordinates.moiLatLan;t=e("#beppeto").val();u=e("#travelmode").val()||"DRIVING";r={origin:i,destination:t,waypoints:[],optimizeWaypoints:!0,provideRouteAlternatives:!0,travelMode:o.maps.TravelMode[u],unitSystem:o.maps.UnitSystem.METRIC};if(!r.destination.length){e("#beppeto").focus();return!1}s.resultsRouter.data("request",{travelMode:r.travelMode,destination:r.destination,preserveViewport:n});s.resultsRouterContent.empty();if(u==="TRANSIT"){r.origin=new o.maps.LatLng(47.410387,9.627245);r.waypoints=[]}this.directionsService.route(r,function(e,t){if(t===o.maps.DirectionsStatus.OK){s.directions.setDirections(e);f[0]&&o.maps.event.trigger(f[0],"click")}else t==="ZERO_RESULTS"?s.resultsRouterContent.html("No route could be found between the origin and destination."):t==="UNKNOWN_ERROR"?s.resultsRouterContent.html("A directions request could not be processed due to a server error. The request may succeed if you try again."):t==="REQUEST_DENIED"?s.resultsRouterContent.html("This webpage is not allowed to use the directions service."):t==="OVER_QUERY_LIMIT"?s.resultsRouterContent.html("The webpage has gone over the requests limit in too short a period of time."):t==="NOT_FOUND"?s.resultsRouterContent.html("At least one of the origin, destination, or waypoints could not be geocoded."):t==="INVALID_REQUEST"?s.resultsRouterContent.html("The DirectionsRequest provided was invalid."):s.resultsRouterContent.html("There was an unknown error in your request. Requeststatus: "+t);s.resultsRouter.show()})};s.prototype.getPanoramino=function(){return this.panoramio};s.prototype.setPanoramino=function(e){this.getPanoramino()||(this.panoramio=new o.maps.panoramio.PanoramioLayer(e||this.panoramioCfg));this.panoramio.setMap(this.map)};s.prototype.unsetPanoramino=function(){this.getPanoramino()&&this.panoramio.setMap(null)};s.prototype.getBicycling=function(){return this.bicycling};s.prototype.setBicycling=function(e){this.getBicycling()||(this.bicycling=new o.maps.BicyclingLayer(e||{}));this.bicycling.setMap(this.map)};s.prototype.unsetBicycling=function(){this.getBicycling()&&this.bicycling.setMap(null)};s.prototype.getTransit=function(){return this.transit};s.prototype.setTransit=function(){this.getTransit()||(this.transit=new o.maps.TransitLayer);this.transit.setMap(this.map)};s.prototype.unsetTransit=function(){this.getTransit()&&this.transit.setMap(null)};s.prototype.getTraffic=function(){return this.traffic};s.prototype.setTraffic=function(){this.getTraffic()||(this.traffic=new o.maps.TrafficLayer);this.traffic.setMap(this.map)};s.prototype.unsetTraffic=function(){this.getTraffic()&&this.traffic.setMap(null)};s.prototype.getWeather=function(){return this.weather};s.prototype.setWeather=function(e){this.getWeather()||(this.weather=new o.maps.weather.WeatherLayer(e||{}));this.weather.setMap(this.map)};s.prototype.unsetWeather=function(){this.getWeather()&&this.weather.setMap(null)};s.prototype.getCloud=function(){return this.cloud};s.prototype.setCloud=function(){this.getCloud()||(this.cloud=new o.maps.weather.CloudLayer);this.cloud.setMap(this.map)};s.prototype.unsetCloud=function(){this.getCloud()&&this.cloud.setMap(null)};s.prototype.getOptions=function(){return this.options};s.prototype.getMap=function(){return this.map};s.prototype.getCoordinates=function(){return this.mapCoordinates};return s}();u=new s("map-canvas","map-directions-results",{mapCfg:{zoom:13},mapCoordinates:{center:{latitude:47.421816,longitude:9.599476}},panoramioCfg:{tag:"rheintal"}});window.beppe=window.beppe||{};e.extend(window.beppe,{calcRoute:function(){u.calcRoute();return!1}});o.maps.event.addDomListener(window,"load",function(){var t,n,r,i;if(window.parent)try{window.parent.beppesFrameHelper.addClass("loaded")}catch(s){r=s}u.mapInitialize();t="btn-inverse";n=u.getOptions();i=function(e,t){switch(e){case"panoramio":t?u.unsetPanoramino():u.setPanoramino();break;case"bicycling":t?u.unsetBicycling():u.setBicycling();break;case"cloud":t?u.unsetCloud():u.setCloud();break;case"weather":t?u.unsetWeather():u.setWeather();break;case"traffic":t?u.unsetTraffic():u.setTraffic();break;case"transit":t?u.unsetTransit():u.setTransit()}};e("#map-control").on({deactivated:function(){e(this).find(".btn").addClass("disabled").attr("disabled","disabled")},activated:function(){e(this).find(".btn").removeClass("disabled").removeAttr("disabled");e(this).find("."+t).each(function(){i(e(this).data("mapcontrol"),!1)})}});e("#map-control .btn[data-mapcontrol]").each(function(){var r,s;r=e(this);s=r.data("mapcontrol");n[s]&&r.addClass(t).find("i").addClass("icon-white");return r.on("click",function(e){var n;e.preventDefault();if(s==="reset"){u.getMap().panTo(u.getCoordinates().centerLatLan);return!1}r.toggleClass(t).find("i").toggleClass("icon-white");n=!r.hasClass(t);i(s,n);return!1})})})}).call(this);